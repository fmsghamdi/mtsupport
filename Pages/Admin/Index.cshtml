@page
@model MabatSupportSystem.Pages.Admin.IndexModel
@inject IStringLocalizer<SharedResource> Localizer
@{
    ViewData["Title"] = Localizer["AdminPanel_Title"];
}

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="fw-bold text-primary mb-1">
                <i class="bi bi-speedometer2 me-2"></i>@Localizer["AdminPanel_Title"]
            </h1>
            <p class="text-muted mb-0">@Localizer["AdminPanel_Subtitle"]</p>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-primary bg-opacity-10 p-3 me-3">
                            <i class="bi bi-ticket-detailed text-primary fs-4"></i>
                        </div>
                        <div>
                            <h2 class="fw-bold mb-0">@Model.TotalTickets</h2>
                            <small class="text-muted">@Localizer["TotalTickets"]</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-warning bg-opacity-10 p-3 me-3">
                            <i class="bi bi-hourglass-split text-warning fs-4"></i>
                        </div>
                        <div>
                            <h2 class="fw-bold mb-0">@Model.OpenTickets</h2>
                            <small class="text-muted">@Localizer["OpenTickets"]</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-success bg-opacity-10 p-3 me-3">
                            <i class="bi bi-people text-success fs-4"></i>
                        </div>
                        <div>
                            <h2 class="fw-bold mb-0">@Model.TotalUsers</h2>
                            <small class="text-muted">@Localizer["TotalUsers"]</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-info bg-opacity-10 p-3 me-3">
                            <i class="bi bi-building text-info fs-4"></i>
                        </div>
                        <div>
                            <h2 class="fw-bold mb-0">@Model.TotalHotels</h2>
                            <small class="text-muted">@Localizer["TotalHotels"]</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold mb-0">
                        <i class="bi bi-lightning me-2 text-warning"></i>@Localizer["QuickActions"]
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-6">
                            <a asp-page="/Admin/Users/Index" class="btn btn-outline-primary w-100 py-3">
                                <i class="bi bi-people d-block fs-3 mb-2"></i>
                                @Localizer["ManageUsers"]
                            </a>
                        </div>
                        <div class="col-6">
                            <a asp-page="/Admin/Hotels/Index" class="btn btn-outline-info w-100 py-3">
                                <i class="bi bi-building d-block fs-3 mb-2"></i>
                                @Localizer["ManageHotels"]
                            </a>
                        </div>
                        <div class="col-6">
                            <a asp-page="/Admin/Users/Create" class="btn btn-outline-success w-100 py-3">
                                <i class="bi bi-person-plus d-block fs-3 mb-2"></i>
                                @Localizer["AddUser"]
                            </a>
                        </div>
                        <div class="col-6">
                            <a asp-page="/Admin/Hotels/Create" class="btn btn-outline-secondary w-100 py-3">
                                <i class="bi bi-plus-square d-block fs-3 mb-2"></i>
                                @Localizer["AddHotel"]
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users by Type -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold mb-0">
                        <i class="bi bi-pie-chart me-2 text-primary"></i>@Localizer["UsersByType"]
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        @foreach (var stat in Model.UserTypeStats)
                        {
                            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span>
                                    @switch (stat.Key)
                                    {
                                        case MabatSupportSystem.Models.UserType.Admin:
                                            <i class="bi bi-shield-check text-danger me-2"></i>
                                            <span>@Localizer["UserType_Admin"]</span>
                                            break;
                                        case MabatSupportSystem.Models.UserType.MabatSupport:
                                            <i class="bi bi-headset text-primary me-2"></i>
                                            <span>@Localizer["UserType_MabatSupport"]</span>
                                            break;
                                        case MabatSupportSystem.Models.UserType.HotelSupport:
                                            <i class="bi bi-building text-info me-2"></i>
                                            <span>@Localizer["UserType_HotelSupport"]</span>
                                            break;
                                        case MabatSupportSystem.Models.UserType.HotelOwner:
                                            <i class="bi bi-person-badge text-success me-2"></i>
                                            <span>@Localizer["UserType_HotelOwner"]</span>
                                            break;
                                        default:
                                            <i class="bi bi-person text-secondary me-2"></i>
                                            <span>@Localizer["UserType_EndUser"]</span>
                                            break;
                                    }
                                </span>
                                <span class="badge bg-primary rounded-pill">@stat.Value</span>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Tickets -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold mb-0">
                        <i class="bi bi-clock-history me-2 text-warning"></i>@Localizer["RecentTickets"]
                    </h5>
                    <a asp-page="/Tickets/Index" class="btn btn-sm btn-outline-primary">
                        @Localizer["ViewAll"] <i class="bi bi-arrow-left ms-1"></i>
                    </a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4">#</th>
                                    <th>@Localizer["TABLE_SUBJECT"]</th>
                                    <th>@Localizer["User"]</th>
                                    <th>@Localizer["Status"]</th>
                                    <th>@Localizer["TABLE_DATE"]</th>
                                    <th class="text-end pe-4">@Localizer["Actions"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var ticket in Model.RecentTickets)
                                {
                                    <tr>
                                        <td class="ps-4 fw-bold text-primary">#@ticket.Id</td>
                                        <td>@ticket.Title</td>
                                        <td>@ticket.UserName</td>
                                        <td>
                                            @{
                                                var statusClass = ticket.Status.ToString() switch
                                                {
                                                    "Open" => "success",
                                                    "InProgress" => "warning",
                                                    "Resolved" => "info",
                                                    _ => "secondary"
                                                };
                                            }
                                            <span class="badge bg-@statusClass">@Localizer[ticket.Status.ToString()]</span>
                                        </td>
                                        <td class="text-muted small">@ticket.CreatedDate.ToString("yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture)</td>
                                        <td class="text-end pe-4">
                                            <a asp-page="/Tickets/Details" asp-route-id="@ticket.Id" class="btn btn-sm btn-light">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
